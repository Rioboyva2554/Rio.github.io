/*! For license information please see TwoFactorAuth.app.e8cb63952c1e763deea4.min.js.LICENSE.txt */
(self.webpackChunkafterlogic_aurora_platform=self.webpackChunkafterlogic_aurora_platform||[]).push([[448],{"Cox/":function(t,e,i){var s,o=o||function(t){"use strict";if(!(void 0===t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=t.document,i=function(){return t.URL||t.webkitURL||t},s=e.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in s,r=/constructor/i.test(t.HTMLElement)||t.safari,n=/CriOS\/[\d]+/.test(navigator.userAgent),a=function(e){(t.setImmediate||t.setTimeout)((function(){throw e}),0)},c=function(t){setTimeout((function(){"string"==typeof t?i().revokeObjectURL(t):t.remove()}),4e4)},u=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},h=function(e,h,p){p||(e=u(e));var l,d=this,y="application/octet-stream"===e.type,f=function(){!function(t,e,i){for(var s=(e=[].concat(e)).length;s--;){var o=t["on"+e[s]];if("function"==typeof o)try{o.call(t,t)}catch(t){a(t)}}}(d,"writestart progress write writeend".split(" "))};if(d.readyState=d.INIT,o)return l=i().createObjectURL(e),void setTimeout((function(){var t,e;s.href=l,s.download=h,t=s,e=new MouseEvent("click"),t.dispatchEvent(e),f(),c(l),d.readyState=d.DONE}));!function(){if((n||y&&r)&&t.FileReader){var s=new FileReader;return s.onloadend=function(){var e=n?s.result:s.result.replace(/^data:[^;]*;/,"data:attachment/file;");t.open(e,"_blank")||(t.location.href=e),e=void 0,d.readyState=d.DONE,f()},s.readAsDataURL(e),void(d.readyState=d.INIT)}l||(l=i().createObjectURL(e)),y?t.location.href=l:t.open(l,"_blank")||(t.location.href=l),d.readyState=d.DONE,f(),c(l)}()},p=h.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,i){return e=e||t.name||"download",i||(t=u(t)),navigator.msSaveOrOpenBlob(t,e)}:(p.abort=function(){},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,function(t,e,i){return new h(t,e||t.name||"download",i)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);t.exports?t.exports.saveAs=o:null!==i.amdD&&null!==i.amdO&&(void 0===(s=function(){return o}.call(e,i,e,t))||(t.exports=s))},a3w2:(t,e,i)=>{"use strict";var s=i("M4cL"),o=i("p09A"),r=i("a7T2"),n=i("H20a"),a=i("KC/L"),c=i("9kOp"),u=i("TdEd"),h=i("skxT");t.exports={ServerModuleName:"TwoFactorAuth",HashModuleName:"two-factor-auth",AuthenticatorAppEnabled:!1,ShowRecommendationToConfigure:!0,AllowBackupCodes:!1,BackupCodesCount:!1,AllowSecurityKeys:!1,AllowAuthenticatorApp:!1,SecurityKeys:[],AllowUsedDevices:!1,CurrentIP:"",TrustDevicesForDays:0,AllowTrustedDevices:!1,init:function(t){var e=r.extend({},t[this.ServerModuleName]||{},t.TwoFactorAuth||{});r.isEmpty(e)||(this.ShowRecommendationToConfigure=a.pBool(e.ShowRecommendationToConfigure,this.ShowRecommendationToConfigure),this.AllowBackupCodes=a.pBool(e.AllowBackupCodes,this.AllowBackupCodes),this.BackupCodesCount=a.pInt(e.BackupCodesCount,this.BackupCodesCount),this.AllowSecurityKeys=a.pBool(e.AllowSecurityKeys,this.AllowSecurityKeys),this.AllowAuthenticatorApp=a.pBool(e.AllowAuthenticatorApp,this.AllowAuthenticatorApp),this.AuthenticatorAppEnabled=this.AllowAuthenticatorApp&&a.pBool(e.AuthenticatorAppEnabled,this.AuthenticatorAppEnabled),this.AllowUsedDevices=a.pBool(e.AllowUsedDevices,this.AllowUsedDevices),this.CurrentIP=a.pString(e.CurrentIP,this.CurrentIP),this.TrustDevicesForDays=a.pInt(e.TrustDevicesForDays,this.TrustDevicesForDays),this.AllowTrustedDevices=this.TrustDevicesForDays>0,this.SecurityKeys=[],a.isNonEmptyArray(e.WebAuthKeysInfo)&&r.each(e.WebAuthKeysInfo,function(t){a.isNonEmptyArray(t,2)&&this.SecurityKeys.push({Id:t[0],keyName:o.observable(t[1])})}.bind(this)),this.checkIfEnabled())},updateShowRecommendation:function(t){this.ShowRecommendationToConfigure=t},updateBackupCodesCount:function(t){this.BackupCodesCount=t},updateAuthenticatorApp:function(t){this.AuthenticatorAppEnabled=!!t},checkIfEnabled:function(){if(!c.isMobile()&&c.isUserNormalOrTenant()&&this.ShowRecommendationToConfigure){var t="settings/two-factor-auth"===window.location.hash||"#settings/two-factor-auth"===window.location.hash,e="settings/security"===window.location.hash||"#settings/security"===window.location.hash;this.AuthenticatorAppEnabled||t||e||setTimeout((function(){var t=u.isModuleEnabled("SecuritySettingsWebclient")?"#settings/security":"#settings/two-factor-auth";h.showLoading(n.i18n("TWOFACTORAUTH/CONFIRM_MODULE_NOT_ENABLED",{TWO_FACTOR_LINK:t})),s(".report_panel.loading a").on("click",(function(){h.hideLoading()})),setTimeout((function(){h.hideLoading()}),1e4)}),100)}}}},Ff0H:(t,e,i)=>{"use strict";var s=i("a7T2"),o=i("H20a"),r=i("9kOp"),n=i("a3w2"),a=i("lYIS");t.exports=function(t){return n.init(t),{start:function(t){if(r.isMobile()||(t.isModuleEnabled("SecuritySettingsWebclient")?t.run("SecuritySettingsWebclient","registerSecuritySettingsSection",[function(){return i("8MZM")},"TwoFactorAuth"]):t.run("SettingsWebclient","registerSettingsTab",[function(){return i("8MZM")},n.HashModuleName,o.i18n("TWOFACTORAUTH/LABEL_SETTINGS_TAB")])),r.getUserRole()===Enums.UserRole.Anonymous){var e=function(t){var e=t.View,o=i("oUN1"),r=i("fvPS");if(e){var n=e.onSystemLoginResponse.bind(e);s.isFunction(n)||(n=e.onSystemLoginResponseBase.bind(e)),s.isFunction(n)||(n=function(){}),e.onSystemLoginResponse=function(t,e){void 0!==e.Parameters.Domain&&(e.Parameters.Login=e.Parameters.Login+"@"+e.Parameters.Domain);var i=t.Result&&t.Result.TwoFactorAuth;if(i)o.showPopup(r,[n,s.bind((function(){this.loading(!1)}),this),i,e.Parameters.Login.split(" ").join(""),e.Parameters.Password]);else{var c=t&&t.Result&&t.Result.AuthToken||"";a.saveDevice(c,(function(){n(t,e)}))}}}}.bind(this);r.subscribeEvent("StandardLoginFormWebclient::ConstructView::after",e),r.subscribeEvent("MailLoginFormWebclient::ConstructView::after",e)}}}}},a48m:(t,e,i)=>{"use strict";var s=i("sdEb"),o=i("H20a"),r=i("KC/L"),n=i("9kOp"),a=i("a3w2");function c(t){this.sDeviceId="",this.bCurrentDevice=!1,this.sDeviceName="",this.sDeviceCustomName="",this.bAuthenticated=!1,this.sDeviceExpiresDate="",this.sDeviceLastUsageDate="",t&&this.parse(t)}c.prototype.parse=function(t){var e=s.unix(t.TrustTillDateTime),i=s.unix(t.LastUsageDateTime);this.sDeviceId=r.pString(t.DeviceId),this.bCurrentDevice=this.sDeviceId===n.getCurrentDeviceId(),this.bAuthenticated=r.pBool(t.Authenticated),this.sDeviceName=r.pString(t.DeviceName),this.sDeviceCustomName=r.pString(t.DeviceCustomName),a.AllowTrustedDevices&&e.diff(s())>0&&(this.sDeviceExpiresDate=o.i18n("TWOFACTORAUTH/LABEL_DEVICE_TRUST_TILL_DATE",{EXPDATE:e.format("MMM D, YYYY")})),this.sDeviceLastUsageDate=o.i18n("TWOFACTORAUTH/LABEL_DEVICE_LAST_USAGE_DATE",{USAGEDATE:i.fromNow()})},t.exports=c},uOT5:(t,e,i)=>{"use strict";var s=i("a7T2"),o=i("p09A"),r=i("H20a"),n=i("KC/L"),a=i("REt5"),c=i("EFhx"),u=i("/QeJ"),h=i("o1lX"),p=i("skxT");function l(){h.call(this),this.sEditVerificator=null,this.fSuccessCallback=null,this.authenticatorQRCodeUrl=o.observable(""),this.authenticatorSecret=o.observable(""),this.authenticatorCode=o.observable(""),this.authenticatorCodeFocus=o.observable(!1),this.saveInProgress=o.observable(!1),this.qrCodeIsLoading=o.observable(!1),this.saveCommand=a.createCommand(this,this.save,(function(){return n.isNonEmptyString(this.authenticatorQRCodeUrl())&&n.isNonEmptyString(this.authenticatorSecret())&&n.isNonEmptyString(this.authenticatorCode())}))}s.extendOwn(l.prototype,h.prototype),l.prototype.PopupTemplate="TwoFactorAuth_ConfigureAuthenticatorAppPopup",l.prototype.onOpen=function(t,e){this.sEditVerificator=t,this.fSuccessCallback=e,this.authenticatorQRCodeUrl(""),this.authenticatorSecret(""),this.authenticatorCode(""),this.authenticatorCodeFocus(!1),this.saveInProgress(!1),this.qrCodeIsLoading(!0),this.getAuthenticatorAppData()},l.prototype.getAuthenticatorAppData=function(){var t={Password:this.sEditVerificator};c.send("TwoFactorAuth","RegisterAuthenticatorAppBegin",t,this.onRegisterAuthenticatorAppBeginResponse,this)},l.prototype.onRegisterAuthenticatorAppBeginResponse=function(t){var e=t&&t.Result;e&&e.Secret&&e.QRcode?(this.authenticatorQRCodeUrl(e.QRcode),this.authenticatorSecret(e.Secret),this.authenticatorCodeFocus(!0)):u.showErrorByCode(t,r.i18n("TWOFACTORAUTH/ERROR_WRONG_PASSWORD"))},l.prototype.save=function(){if(n.isNonEmptyString(this.authenticatorCode())){var t={Password:this.sEditVerificator,Code:this.authenticatorCode(),Secret:this.authenticatorSecret()};this.saveInProgress(!0),c.send("TwoFactorAuth","RegisterAuthenticatorAppFinish",t,this.onRegisterAuthenticatorAppFinishResponse,this)}},l.prototype.onRegisterAuthenticatorAppFinishResponse=function(t){this.saveInProgress(!1),t&&t.Result?(s.isFunction(this.fSuccessCallback)&&this.fSuccessCallback(),this.closePopup()):p.showError(r.i18n("TWOFACTORAUTH/ERROR_WRONG_CODE"))},t.exports=new l},ED4b:(t,e,i)=>{"use strict";var s=i("a7T2"),o=i("p09A"),r=i("H20a"),n=i("EFhx"),a=i("/QeJ"),c=i("o1lX");function u(){c.call(this),this.fSuccessCallback=null,this.password=o.observable(""),this.passwordFocus=o.observable(!0),this.inProgress=o.observable(!1)}s.extendOwn(u.prototype,c.prototype),u.prototype.PopupTemplate="TwoFactorAuth_ConfirmPasswordPopup",u.prototype.onOpen=function(t){this.fSuccessCallback=t,this.password(""),this.passwordFocus(!0)},u.prototype.verifyPassword=function(){var t={Password:this.password()};this.inProgress(!0),n.send("TwoFactorAuth","VerifyPassword",t,this.onVerifyPasswordResponse,this)},u.prototype.onVerifyPasswordResponse=function(t){this.inProgress(!1),t&&t.Result?(s.isFunction(this.fSuccessCallback)&&this.fSuccessCallback(this.password()),this.closePopup()):a.showErrorByCode(t,r.i18n("TWOFACTORAUTH/ERROR_WRONG_PASSWORD"))},t.exports=new u},"8tFG":(t,e,i)=>{"use strict";var s=i("a7T2"),o=i("p09A"),r=i("H20a"),n=i("KC/L"),a=i("REt5"),c=i("EFhx"),u=i("/QeJ"),h=i("o1lX"),p=(i("skxT"),i("CasK"));function l(){h.call(this),this.bSecurityKeysNotSupportedError=!(navigator.credentials&&navigator.credentials.create),this.bIsHttps="https:"===window.location.protocol,this.sEditVerificator="",this.sName="",this.iId=0,this.name=o.observable(""),this.nameFocus=o.observable(!0),this.saveNameInProgress=o.observable(!1),this.securityKeyInProgress=o.observable(!1),this.securityKeyError=o.observable(!1),this.securityKeyCanceled=o.observable(!1),this.saveCommand=a.createCommand(this,this.save,(function(){return n.isNonEmptyString(this.name())}))}s.extendOwn(l.prototype,h.prototype),l.prototype.PopupTemplate="TwoFactorAuth_CreateSecurityKeyPopup",l.prototype.onOpen=function(t,e){this.sEditVerificator=t,this.fCallback=e,this.registerSecurityKey()},l.prototype.registerSecurityKey=function(t){this.bSecurityKeysNotSupportedError?(this.securityKeyInProgress(!1),this.securityKeyError(!0)):(this.iId=0,this.name(""),this.securityKeyInProgress(!0),this.securityKeyError(!1),this.securityKeyCanceled(!1),c.send("TwoFactorAuth","RegisterSecurityKeyBegin",{Password:this.sEditVerificator},this.onRegisterSecurityKeyBeginResponse,this))},l.prototype.onRegisterSecurityKeyBeginResponse=function(t){var e=this;if(t&&t.Result){var i=t.Result;i.publicKey.challenge=p.base64ToArrayBuffer(i.publicKey.challenge),i.publicKey.user.id=p.base64ToArrayBuffer(i.publicKey.user.id),navigator.credentials.create(i).then((function(t){var i={Password:e.sEditVerificator,Attestation:{attestationObject:p.arrayBufferToBase64(t.response.attestationObject),clientDataJSON:p.arrayBufferToBase64(t.response.clientDataJSON)}};c.send("TwoFactorAuth","RegisterSecurityKeyFinish",i,e.onRegisterSecurityKeyFinishResponse,e)})).catch((function(t){e.securityKeyInProgress(!1),e.securityKeyCanceled(!0)}))}else this.securityKeyInProgress(!1),this.closePopup(),u.showErrorByCode(t,r.i18n("TWOFACTORAUTH/ERROR_ADD_SECURITY_KEY"))},l.prototype.onRegisterSecurityKeyFinishResponse=function(t){this.securityKeyInProgress(!1),t&&t.Result?(this.iId=t.Result,this.nameFocus(!0)):(this.closePopup(),u.showErrorByCode(t,r.i18n("TWOFACTORAUTH/ERROR_ADD_SECURITY_KEY")))},l.prototype.save=function(){if(n.isNonEmptyString(this.name())){var t={Password:this.sEditVerificator,KeyId:this.iId,NewName:this.name()};this.saveNameInProgress(!0),c.send("TwoFactorAuth","UpdateSecurityKeyName",t,this.onUpdateSecurityKeyNameResponse,this)}},l.prototype.onUpdateSecurityKeyNameResponse=function(t){this.saveNameInProgress(!1),t&&t.Result?(s.isFunction(this.fCallback)&&this.fCallback(this.iId,this.name()),this.closePopup()):(s.isFunction(this.fCallback)&&this.fCallback(this.iId,""),this.closePopup(),u.showErrorByCode(t,r.i18n("TWOFACTORAUTH/ERROR_SETUP_SECRET_KEY_NAME")))},l.prototype.cancelPopup=function(){},l.prototype.onEscHandler=function(t){},t.exports=new l},"1hAi":(t,e,i)=>{"use strict";var s=i("a7T2"),o=i("p09A"),r=i("EFhx"),n=i("/QeJ"),a=i("o1lX");function c(){a.call(this),this.deviceId=o.observable(""),this.customUaName=o.observable(""),this.customName=o.observable(""),this.successCallback=function(){},this.inProgress=o.observable(!1)}s.extendOwn(c.prototype,a.prototype),c.prototype.PopupTemplate="TwoFactorAuth_EditDevicePopup",c.prototype.onOpen=function(t,e,i,s){this.deviceId(t),this.customUaName(e),this.customName(i),this.successCallback="function"==typeof s?s:function(){}},c.prototype.saveCustomName=function(){var t={DeviceId:this.deviceId(),DeviceCustomName:this.customName()};this.inProgress(!0),r.send("TwoFactorAuth","SetDeviceCustomName",t,this.onSetDeviceCustomNameResponse,this)},c.prototype.onSetDeviceCustomNameResponse=function(t){this.inProgress(!1),t&&t.Result?(this.successCallback(),this.closePopup()):n.showErrorByCode(t)},t.exports=new c},OcLG:(t,e,i)=>{"use strict";var s=i("a7T2"),o=i("p09A"),r=i("H20a"),n=i("KC/L"),a=i("REt5"),c=i("EFhx"),u=i("/QeJ"),h=i("o1lX");function p(){h.call(this),this.sEditVerificator="",this.sName="",this.iId=0,this.name=o.observable(""),this.nameFocus=o.observable(!0),this.inProgress=o.observable(!1),this.saveCommand=a.createCommand(this,this.save,(function(){return n.isNonEmptyString(this.name())}))}i("skxT"),s.extendOwn(p.prototype,h.prototype),p.prototype.PopupTemplate="TwoFactorAuth_EditSecurityKeyPopup",p.prototype.onOpen=function(t,e,i,s){this.sEditVerificator=t,this.iId=e,this.name(i),this.nameFocus(!0),this.fCallback=s},p.prototype.save=function(){if(n.isNonEmptyString(this.name())){var t={Password:this.sEditVerificator,KeyId:this.iId,NewName:this.name()};this.inProgress(!0),c.send("TwoFactorAuth","UpdateSecurityKeyName",t,this.onUpdateSecurityKeyNameResponse,this)}},p.prototype.onUpdateSecurityKeyNameResponse=function(t){this.inProgress(!1),t&&t.Result?(s.isFunction(this.fCallback)&&this.fCallback(this.iId,this.name()),this.closePopup()):u.showErrorByCode(t,r.i18n("TWOFACTORAUTH/ERROR_SETUP_SECRET_KEY_NAME"))},t.exports=new p},Um7v:(t,e,i)=>{"use strict";var s=i("M4cL"),o=i("a7T2"),r=i("p09A"),n=i("sdEb"),a=i("H20a"),c=i("KC/L"),u=i("REt5"),h=i("EFhx"),p=i("9kOp"),l=i("o1lX"),d=i("XeMN"),y=i("Cox/"),f=i("oUN1"),A=i("mGms"),C=i("a3w2");function v(){l.call(this),this.sEditVerificator="",this.backupCodes=r.observableArray([]),this.codesGeneratedDataInfo=r.observable(""),this.fCallBack=null,this.generatingBackupCodes=r.observable(!1),this.generateBackupCodesCommand=u.createCommand(this,this.confirmGenerateNewBackupCodes,(function(){return!this.generatingBackupCodes()}))}o.extendOwn(v.prototype,l.prototype),v.prototype.PopupTemplate="TwoFactorAuth_ShowBackupCodesPopup",v.prototype.onOpen=function(t,e){this.sEditVerificator=t,this.fCallBack=e,C.BackupCodesCount>0?this.getBackupCodes():(this.backupCodes([]),this.codesGeneratedDataInfo(""),this.generateBackupCodes())},v.prototype.onClose=function(){o.isFunction(this.fCallBack)&&this.fCallBack(o.without(this.backupCodes(),"").length)},v.prototype.getBackupCodes=function(){this.backupCodes([]),this.codesGeneratedDataInfo(""),this.generatingBackupCodes(!0),h.send("TwoFactorAuth","GetBackupCodes",{Password:this.sEditVerificator},(function(t){this.generatingBackupCodes(!1),this.parseBackupCodes(t)}),this)},v.prototype.confirmGenerateNewBackupCodes=function(){f.showPopup(d,[a.i18n("TWOFACTORAUTH/INFO_GET_NEW_CODES"),function(t){t&&this.generateBackupCodes()}.bind(this),a.i18n("TWOFACTORAUTH/CONFIRM_GET_NEW_CODES")])},v.prototype.generateBackupCodes=function(){this.generatingBackupCodes(!0),h.send("TwoFactorAuth","GenerateBackupCodes",{Password:this.sEditVerificator},(function(t){this.generatingBackupCodes(!1),this.parseBackupCodes(t)}),this)},v.prototype.parseBackupCodes=function(t){var e=t&&t.Result,i=e&&e.Codes;if(c.isNonEmptyArray(i)){var s=n.unix(e.Datetime);this.codesGeneratedDataInfo(a.i18n("TWOFACTORAUTH/INFO_CODES_GENERATED_DATA",{DATA:s.format("MMM D, YYYY")})),this.backupCodes(i)}},v.prototype.getBackupCodesFileText=function(){var t="";return t+=a.i18n("TWOFACTORAUTH/HEADING_SAVE_CODES")+"\n",t+=a.i18n("TWOFACTORAUTH/INFO_KEEP_CODES_SAFE")+"\n",t+="\n",o.each(this.backupCodes(),(function(e,i){t+=i+1+". "+e+"\n"})),t+="\n",t+=p.getUserPublicId()+"\n",t+="\n",t+=a.i18n("TWOFACTORAUTH/INFO_USE_CODE_ONCE")+"\n",t+=this.codesGeneratedDataInfo()+"\n"},v.prototype.print=function(){var t=this.getBackupCodesFileText(),e=A.open("","backup-codes-"+p.getUserPublicId()+"-print");e&&(s(e.document.body).html("<pre>"+t+"</pre>"),e.print())},v.prototype.download=function(){var t=this.getBackupCodesFileText(),e=new Blob([t],{type:"text/plain;charset=utf-8"});y.saveAs(e,"backup-codes-"+p.getUserPublicId()+".txt",!0)},t.exports=new v},fvPS:(t,e,i)=>{"use strict";var s=i("a7T2"),o=i("p09A"),r=i("H20a"),n=i("REt5"),a=i("EFhx"),c=i("/QeJ"),u=i("9kOp"),h=i("o1lX"),p=i("skxT"),l=i("CasK"),d=i("nmKc"),y=i("a3w2"),f=i("lYIS");function A(){h.call(this),this.isMobile=o.observable(u.isMobile()||!1),this.afterVerifyCallback=function(){},this.fOnCancel=null,this.login=o.observable(null),this.sPassword=null,this.bAllowTrustedDevices=y.AllowTrustedDevices,this.verificationResponse=o.observable(null),this.verificationPassed=o.computed((function(){return null!==this.verificationResponse()}),this),this.verificationResponse.subscribe((function(){this.verificationPassed()&&!this.bAllowTrustedDevices&&(this.afterVerify(),this.closePopup())}),this),this.trustThisBrowser=o.observable(!1),this.sTrustThisBrowserText=r.i18n("TWOFACTORAUTH/LABEL_TRUST_DEVICE_PLURAL",{COUNT:y.TrustDevicesForDays},null,y.TrustDevicesForDays),this.allOptionsVisible=o.observable(!1),this.securityKeyVisible=o.observable(!1),this.authenticatorAppVisible=o.observable(!1),this.backupCodesVisible=o.observable(!1),this.hasSecurityKey=o.observable(!1),this.securityKeyInProgress=o.observable(!1),this.securityKeyError=o.observable(!1),this.bSecurityKeysNotSupportedError=!(navigator.credentials&&navigator.credentials.get),this.bIsHttps="https:"===window.location.protocol,this.hasAuthenticatorApp=o.observable(!1),this.authenticatorCode=o.observable(""),this.authenticatorCodeFocused=o.observable(!1),this.authenticatorCodeInProgress=o.observable(!1),this.hasBackupCodes=o.observable(!1),this.backupCode=o.observable(!1),this.backupCodeFocus=o.observable(!1),this.backupCodeInProgress=o.observable(!1),this.hasSeveralOptions=o.computed((function(){var t=0;return this.hasSecurityKey()&&t++,this.hasAuthenticatorApp()&&t++,this.hasBackupCodes()&&t++,t>1}),this),this.continueInProgress=o.observable(!1),this.continueCommand=n.createCommand(this,this.afterVerify,(function(){return!this.continueInProgress()}))}s.extendOwn(A.prototype,h.prototype),A.prototype.PopupTemplate="TwoFactorAuth_VerifySecondFactorPopup",A.prototype.onOpen=function(t,e,i,s,o){this.continueInProgress(!1),this.afterVerifyCallback="function"==typeof t?t:function(){},this.fOnCancel=e,this.login(s),this.sPassword=o,this.hasSecurityKey(y.AllowSecurityKeys&&i.HasSecurityKey),this.hasAuthenticatorApp(y.AllowAuthenticatorApp&&i.HasAuthenticatorApp),this.hasBackupCodes(y.AllowBackupCodes&&i.HasBackupCodes),this.verificationResponse(null),this.authenticatorCode(""),this.authenticatorCodeInProgress(!1),this.backupCode(""),this.backupCodeInProgress(!1),this.allOptionsVisible(!1),this.securityKeyVisible(!1),this.authenticatorAppVisible(!1),this.backupCodesVisible(!1),this.hasSecurityKey()?this.useSecurityKey():this.hasAuthenticatorApp()&&this.useAuthenticatorApp()},A.prototype.useOtherOption=function(){this.allOptionsVisible(!0),this.securityKeyVisible(!1),this.authenticatorAppVisible(!1),this.backupCodesVisible(!1)},A.prototype.useSecurityKey=function(){this.hasSecurityKey()&&(this.allOptionsVisible(!1),this.securityKeyVisible(!0),this.authenticatorAppVisible(!1),this.backupCodesVisible(!1),this.verifySecurityKey())},A.prototype.useAuthenticatorApp=function(){this.hasAuthenticatorApp()&&(this.allOptionsVisible(!1),this.securityKeyVisible(!1),this.authenticatorAppVisible(!0),this.backupCodesVisible(!1),this.authenticatorCodeFocused(!0))},A.prototype.useBackupCodes=function(){this.hasBackupCodes()&&(this.allOptionsVisible(!1),this.securityKeyVisible(!1),this.authenticatorAppVisible(!1),this.backupCodesVisible(!0),this.backupCodeFocus(!0))},A.prototype.verifySecurityKey=function(){if(this.bSecurityKeysNotSupportedError)this.securityKeyInProgress(!1),this.securityKeyError(!0);else{var t={Login:this.login(),Password:this.sPassword};this.securityKeyInProgress(!0),this.securityKeyError(!1),a.send("TwoFactorAuth","VerifySecurityKeyBegin",t,this.onVerifySecurityKeyBegin,this)}},A.prototype.onVerifySecurityKeyBegin=function(t){var e=this,i=t&&t.Result;i?(i.publicKey.challenge=l.base64ToArrayBuffer(i.publicKey.challenge),i.publicKey.allowCredentials.forEach((function(t){t.id=l.base64ToArrayBuffer(t.id)})),navigator.credentials.get(i).then((function(t){var i=t&&t.response,s={Login:e.login(),Password:e.sPassword,Attestation:{id:t&&t.rawId?l.arrayBufferToBase64(t.rawId):null,clientDataJSON:i&&i.clientDataJSON?l.arrayBufferToBase64(i.clientDataJSON):null,authenticatorData:i&&i.authenticatorData?l.arrayBufferToBase64(i.authenticatorData):null,signature:i&&i.signature?l.arrayBufferToBase64(i.signature):null}};a.send("TwoFactorAuth","VerifySecurityKeyFinish",s,e.onVerifySecurityKeyFinish,e)})).catch((function(t){e.securityKeyInProgress(!1),e.securityKeyError(!0)}))):(this.securityKeyInProgress(!1),this.securityKeyError(!0),c.showErrorByCode(t,r.i18n("TWOFACTORAUTH/ERROR_VERIFY_SECURITY_KEY")))},A.prototype.onVerifySecurityKeyFinish=function(t){this.securityKeyInProgress(!1),t&&t.Result?this.verificationResponse(t):(this.securityKeyError(!0),c.showErrorByCode(t,r.i18n("TWOFACTORAUTH/ERROR_VERIFY_SECURITY_KEY")))},A.prototype.verifyAuthenticatorCode=function(){var t={Login:this.login(),Password:this.sPassword,Code:this.authenticatorCode()};this.authenticatorCodeInProgress(!0),a.send("TwoFactorAuth","VerifyAuthenticatorAppCode",t,this.onVerifyAuthenticatorAppCodeResponse,this)},A.prototype.onVerifyAuthenticatorAppCodeResponse=function(t){var e=t.Result;this.authenticatorCodeInProgress(!1),this.authenticatorCode(""),e?this.verificationResponse(t):p.showError(r.i18n("TWOFACTORAUTH/ERROR_WRONG_CODE"))},A.prototype.verifyBackupCode=function(){var t={Login:this.login(),Password:this.sPassword,BackupCode:this.backupCode()};this.backupCodeInProgress(!0),a.send("TwoFactorAuth","VerifyBackupCode",t,this.onVerifyBackupCode,this)},A.prototype.onVerifyBackupCode=function(t){var e=t.Result;this.backupCodeInProgress(!1),this.backupCode(""),e?this.verificationResponse(t):p.showError(r.i18n("TWOFACTORAUTH/ERROR_WRONG_BACKUP_CODE"))},A.prototype.cancelPopup=function(){s.isFunction(this.fOnCancel)&&this.fOnCancel(!1),this.closePopup()},A.prototype.afterVerify=function(){var t=this,e=this.verificationResponse()&&this.verificationResponse().Result&&this.verificationResponse().Result.AuthToken||"";f.saveDevice(e,(function(){t.trustDevice(e,(function(){t.afterVerifyCallback(t.verificationResponse())}))}))},A.prototype.trustDevice=function(t,e){if(y.AllowUsedDevices&&this.trustThisBrowser()){var i={DeviceId:u.getCurrentDeviceId(),DeviceName:d.getName(),Trust:this.trustThisBrowser()};this.continueInProgress(!0),a.send("TwoFactorAuth","TrustDevice",i,(function(t){t&&t.Result?e():c.showErrorByCode(t)}),this,null,t)}else e()},t.exports=new A},lYIS:(t,e,i)=>{"use strict";var s=i("EFhx"),o=i("9kOp"),r=i("nmKc"),n=i("a3w2");t.exports={saveDevice:function(t,e){if(n.AllowUsedDevices){var i={DeviceId:o.getCurrentDeviceId(),DeviceName:r.getName()};s.send("TwoFactorAuth","SaveDevice",i,e,this,null,t)}else e()}}},CasK:t=>{"use strict";var e={base64ToArrayBuffer:function(t){for(var e=window.atob(t),i=e.length,s=new Uint8Array(i),o=0;o<i;o++)s[o]=e.charCodeAt(o);return s.buffer},arrayBufferToBase64:function(t){for(var e="",i=new Uint8Array(t),s=i.byteLength,o=0;o<s;o++)e+=String.fromCharCode(i[o]);return window.btoa(e)}};t.exports=e},nmKc:(t,e,i)=>{"use strict";var s=i("+147"),o=i("H20a"),r=i("KC/L");t.exports={getName:function(){var t=navigator.userAgent,e=s(r.pString(t));return o.i18n("TWOFACTORAUTH/LABEL_DEVICE_NAME",{NAME:"".concat(e.browser.name,"/").concat(r.pInt(e.browser.version)),PLATFORM:"".concat(e.os.name," ").concat(e.os.version)})}}},"8MZM":(t,e,i)=>{"use strict";var s=i("a7T2"),o=i("p09A"),r=i("H20a"),n=i("KC/L"),a=i("REt5"),c=i("EFhx"),u=i("/QeJ"),h=i("XeMN"),p=i("TdEd"),l=i("oUN1"),d=i("skxT"),y=p.run("SettingsWebclient","getAbstractSettingsFormViewClass"),f=i("a48m"),A=i("uOT5"),C=i("ED4b"),v=i("8tFG"),b=i("1hAi"),T=i("a3w2"),w=i("OcLG"),E=i("Um7v");function R(){y.call(this,T.ServerModuleName),this.subPage=o.observable(!1),this.visibleHeading=o.observable(!0),this.showRecommendationToConfigure=o.observable(T.ShowRecommendationToConfigure),this.bAllowSecurityKeys=T.AllowSecurityKeys,this.bAllowAuthenticatorApp=T.AllowAuthenticatorApp,this.securityKeys=o.observableArray(T.SecurityKeys),this.hasBackupCodes=o.observable(!1),this.infoShowBackupCodes=o.observable(""),this.hasAuthenticatorApp=o.observable(T.AuthenticatorAppEnabled),this.isEnabledTwoFactorAuth=o.computed((function(){return this.hasAuthenticatorApp()||this.securityKeys().length>0}),this),this.isEnabledTwoFactorAuth.subscribe((function(){this.isEnabledTwoFactorAuth()||(T.updateBackupCodesCount(0),this.populateSettings())}),this),this.sEditVerificator="",this.passwordVerified=o.observable(!1),this.passwordVerified.subscribe((function(t){this.subPage(!!t)}),this),this.allowBackupCodes=o.computed((function(){return T.AllowBackupCodes&&(this.hasAuthenticatorApp()||this.securityKeys().length>0)&&this.passwordVerified()}),this),this.devices=o.observableArray([]),this.allowUsedDevices=o.computed((function(){return T.AllowUsedDevices&&this.devices().length>0}),this),this.allowRevokeAll=o.computed((function(){return T.AllowTrustedDevices&&!!s.find(this.devices(),(function(t){return n.isNonEmptyString(t.sDeviceExpiresDate)}))}),this),this.populateSettings(),this.revokeAllCommand=a.createCommand(this,this.askRevokeTrustFromAllDevices,(function(){return this.allowRevokeAll()}))}s.extendOwn(R.prototype,y.prototype),R.prototype.ViewTemplate="TwoFactorAuth_TwoFactorAuthSettingsFormView",R.prototype.onShow=function(){this.clearAll()},R.prototype.clearAll=function(){this.sEditVerificator="",this.passwordVerified(!1),this.populateSettings(),this.getUsedDevices()},R.prototype.populateSettings=function(){this.showRecommendationToConfigure(T.ShowRecommendationToConfigure),this.hasAuthenticatorApp(T.AuthenticatorAppEnabled),this.hasBackupCodes(T.BackupCodesCount>0),this.infoShowBackupCodes(this.hasBackupCodes()?r.i18n("TWOFACTORAUTH/INFO_SHOW_BACKUP_CODES",{COUNT:T.BackupCodesCount}):"")},R.prototype.confirmPassword=function(){l.showPopup(C,[function(t){this.sEditVerificator=t,this.passwordVerified(!0)}.bind(this)])},R.prototype.setupAuthenticatorApp=function(){l.showPopup(A,[this.sEditVerificator,function(){T.updateAuthenticatorApp(!0),this.populateSettings(),this.disableShowRecommendation()}.bind(this)])},R.prototype.disableShowRecommendation=function(){this.showRecommendationToConfigure()&&(this.showRecommendationToConfigure(!1),c.send("TwoFactorAuth","UpdateSettings",{ShowRecommendationToConfigure:!1},function(){T.updateShowRecommendation(!1),this.populateSettings()}.bind(this)))},R.prototype.askDisableAuthenticatorApp=function(){var t=r.i18n("TWOFACTORAUTH/CONFIRM_DISABLE_AUTHENTICATOR_APP");l.showPopup(h,[t,s.bind((function(t){t&&this.disableAuthenticatorApp()}),this)])},R.prototype.disableAuthenticatorApp=function(){var t={Password:this.sEditVerificator};c.send("TwoFactorAuth","DisableAuthenticatorApp",t),T.updateAuthenticatorApp(!1),this.populateSettings()},R.prototype.showBackupCodes=function(){this.allowBackupCodes()&&l.showPopup(E,[this.sEditVerificator,function(t){T.updateBackupCodesCount(t),this.populateSettings()}.bind(this)])},R.prototype.addSecurityKey=function(){l.showPopup(v,[this.sEditVerificator,this.addCreatedSecurityKey.bind(this)])},R.prototype.addCreatedSecurityKey=function(t,e){this.securityKeys.push({Id:t,keyName:o.observable(e)}),this.disableShowRecommendation()},R.prototype.askNewSecurityKeyName=function(t,e){l.showPopup(w,[this.sEditVerificator,t,e,this.updateSecurityKeyName.bind(this)])},R.prototype.updateSecurityKeyName=function(t,e){s.each(this.securityKeys(),(function(i){i.Id===t&&i.keyName(e)})),this.securityKeys.valueHasMutated()},R.prototype.askRemoveSecurityKey=function(t,e){var i=r.i18n("TWOFACTORAUTH/CONFIRM_REMOVE_SECURITY_KEY",{KEYNAME:e});l.showPopup(h,[i,s.bind((function(e){e&&this.removeSecurityKey(t)}),this)])},R.prototype.removeSecurityKey=function(t){c.send("TwoFactorAuth","DeleteSecurityKey",{Password:this.sEditVerificator,KeyId:t},(function(e){e&&e.Result?(this.securityKeys(s.filter(this.securityKeys(),(function(e){return e.Id!==t}))),d.showReport(r.i18n("TWOFACTORAUTH/REPORT_DELETE_SECURITY_KEY"))):u.showErrorByCode(e,r.i18n("TWOFACTORAUTH/ERROR_DELETE_SECURITY_KEY"))}),this)},R.prototype.getUsedDevices=function(){c.send("TwoFactorAuth","GetUsedDevices",{},(function(t){var e=t&&t.Result,i=[];n.isNonEmptyArray(e)&&s.each(e,(function(t){var e=new f(t);i.push(e)})),this.devices(i)}),this)},R.prototype.askRevokeTrustFromAllDevices=function(){var t=r.i18n("TWOFACTORAUTH/CONFIRM_REVOKE_ALL"),e=r.i18n("TWOFACTORAUTH/CONFIRM_HEADING_REVOKE_ALL");l.showPopup(h,[t,s.bind((function(t){t&&this.revokeTrustFromAllDevices()}),this),e])},R.prototype.revokeTrustFromAllDevices=function(){c.send("TwoFactorAuth","RevokeTrustFromAllDevices",{},(function(t){this.getUsedDevices(),t&&t.Result||u.showErrorByCode(t,r.i18n("TWOFACTORAUTH/ERROR_REVOKE_TRUST"))}),this)},R.prototype.askLogoutFromDevice=function(t,e){var i=r.i18n("TWOFACTORAUTH/CONFIRM_LOGOUT_DEVICE"),o=r.i18n("TWOFACTORAUTH/CONFIRM_HEADING_LOGOUT_DEVICE",{NAME:e});l.showPopup(h,[i,s.bind((function(e){e&&this.logoutFromDevice(t)}),this),o])},R.prototype.logoutFromDevice=function(t){var e={DeviceId:t};c.send("TwoFactorAuth","LogoutFromDevice",e,(function(t){this.getUsedDevices(),t&&t.Result||u.showErrorByCode(t,r.i18n("TWOFACTORAUTH/ERROR_LOGOUT_DEVICE"))}),this)},R.prototype.askRemoveDevice=function(t,e){var i=r.i18n("TWOFACTORAUTH/CONFIRM_LOGOUT_DEVICE"),o=r.i18n("TWOFACTORAUTH/CONFIRM_HEADING_REMOVE_DEVICE",{NAME:e});l.showPopup(h,[i,s.bind((function(e){e&&this.removeDevice(t)}),this),o])},R.prototype.removeDevice=function(t){var e={DeviceId:t};c.send("TwoFactorAuth","RemoveDevice",e,(function(t){this.getUsedDevices(),t&&t.Result||u.showErrorByCode(t,r.i18n("TWOFACTORAUTH/ERROR_LOGOUT_DEVICE"))}),this)},R.prototype.editDevice=function(t,e,i){var s=this;l.showPopup(b,[t,e,i,function(){s.getUsedDevices()}])},t.exports=new R}}]);